# PendulumSim 性能优化报告

## 目标与约束

- 60fps 流畅动画
- 页面加载时间 < 2s（避免引入重型依赖）
- 内存占用 < 100MB

## 关键设计

- 固定步长物理推进（`dt=1/240`）与渲染帧率解耦：降低数值误差，避免不同设备帧率波动导致物理不一致。
- 动力学在角度坐标下构建质量矩阵并解线性系统（n≤3），计算量固定且很小，数值稳定性更好。
- Canvas 单层渲染：轨迹、摆杆、摆锤、能量图在同一 canvas 上绘制，减少额外 DOM。

## 绘制与数据结构优化

- 轨迹与能量历史均使用 “有限长度数组” 做环形缓冲思想（超过上限立即截断），避免无限增长。
  - 轨迹长度默认 450 点，可在 UI 调整（上限 2000）。
  - 能量缓存固定最多 360 点，用于小型曲线面板。
- 每帧避免 React setState 重渲染：动画循环在 Canvas 内部执行，UI 只在交互/参数变更时更新。

## 内存估算（默认值）

- 轨迹 450 点 × 2 数值 ≈ 900 number，能量 360 点 × 3 数值 ≈ 1080 number。
- 加上对象封装与 JS 开销，远低于 100MB 上限。

## 进一步优化建议

- 当轨迹长度设置较大（>1500）且设备性能较弱时，可按帧采样（例如每 2 帧记录一次轨迹点）。
- 若后续增加更多可视化图层，优先在同一 canvas 中分区绘制，减少多 canvas 的像素填充成本。
